version: 2

models:
  - name: contracts_optimism_daily_usage_summary
    meta:
      blockchain: optimism
      sector: contracts
      contributors: msilb7
    config:
      tags: ['optimism','op','contracts','usage']
    description: >
        A table daily aggregate address usage statistics
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
              - blockchain
              - address
              - block_date
    columns:
    - &blockchain
      name: blockchain
      description: "Blockchain"
    - &address
      name: address
      description: "Contract Address"
    - &block_month
      name: block_month
      description: "Month of the block"
    - &block_date
      name: block_date
      description: "Date of the block"
    - &num_to_blocks
      name: num_to_blocks
      description: "Amount of blocks where the contract was the 'to address' for successful transactions"
    - &num_to_txs
      name: num_to_txs
      description: "Amount of successful transactions where the contract was the 'to address'"
    - &num_to_tx_senders
      name: num_to_tx_senders
      description:  "Unique amount of from addresses in transactions where the contract was the 'to address'"
    - &sum_to_tx_gas_used
      name: sum_to_tx_gas_used
      description:  "Amount of gas used by successful transactions where the contract was the 'to address'"
    - &sum_to_tx_calldata_bytes
      name: sum_to_tx_calldata_bytes
      description:  "Amount of calldata bytes used by successful transactions where the contract was the 'to address'"
    - &sum_to_tx_calldata_gas
      name: sum_to_tx_calldata_gas
      description:  "Amount of calldata gas used by successful transactions where the contract was the 'to address'"
    - &num_trace_blocks
      name: num_trace_blocks
      description: "Amount of blocks where the contract was called in traces for successful traces"
    - &num_trace_txs
      name: num_trace_txs
      description: "Amount of successful transactions where the contract was called in traces"
    - &num_trace_calls
      name: num_trace_calls
      description:  "Amount of successful calls where the contract was called in traces"
    - &num_trace_tx_senders
      name: num_trace_tx_senders
      description:  "Amount of from addresses for successful transactions where the contract was called in traces"
    - &num_trace_call_senders
      name: num_trace_call_senders
      description:  "Amount of from addresses for successful traces where the contract was called in traces"
    - &sum_trace_gas_used
      name: sum_trace_gas_used
      description:  "Amount of gas used in successful traces where the contract was called in traces (including sub-trace gas used)"
    - &sum_trace_tx_gas_used
      name: sum_trace_tx_gas_used
      description:   "Amount of gas used in successful transactions where the contract was called in traces"
    - &num_log_blocks
      name: num_log_blocks
      description:  "Amount of blocks where the contract was called in traces for successful event logs"
    - &num_log_txs
      name: num_log_txs
      description:  "Amount of successful transactions where the contract emitted an event log"
    - &num_log_events
      name: num_log_events
      description:   "Amount of successful event logs where the contract emitted an event log"
    - &num_log_tx_senders
      name: num_log_tx_senders
      description:   "Amount of from addresses for successful transactions where the contract emitted an event log"
    - &sum_log_tx_gas_used
      name: sum_log_tx_gas_used
      description:   "Amount of gas used by successful transactions where the contract emitted an event log"

  - name: contracts_optimism_daily_usage_summary_logs
    meta:
      blockchain: optimism
      sector: contracts
      contributors: msilb7
    config:
      tags: ['optimism','op','contracts','usage']
    description: >
        A table daily aggregate address usage statistics by logs
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
              - blockchain
              - address
              - block_date
    columns:
    - *blockchain
    - *address
    - *block_month
    - *block_date
    - *num_log_blocks
    - *num_log_txs
    - *num_log_events
    - *num_log_tx_senders
    - *sum_log_tx_gas_used

  - name: contracts_optimism_daily_usage_summary_traces
    meta:
      blockchain: optimism
      sector: contracts
      contributors: msilb7
    config:
      tags: ['optimism','op','contracts','usage']
    description: >
        A table daily aggregate address usage statistics by traces
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
              - blockchain
              - address
              - block_date
    columns:
    - *blockchain
    - *address
    - *block_month
    - *block_date
    - *num_trace_blocks
    - *num_trace_txs
    - *num_trace_calls
    - *num_trace_tx_senders
    - *num_trace_call_senders
    - *sum_trace_gas_used
    - *sum_trace_tx_gas_used

  - name: contracts_optimism_daily_usage_summary_transactions
    meta:
      blockchain: optimism
      sector: contracts
      contributors: msilb7
    config:
      tags: ['optimism','op','contracts','usage']
    description: >
        A table daily aggregate address usage statistics by transactions
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
              - blockchain
              - address
              - block_date
    columns:
    - *blockchain
    - *address
    - *block_month
    - *block_date
    - *num_to_blocks
    - *num_to_txs
    - *num_to_tx_senders
    - *sum_to_tx_gas_used
    - *sum_to_tx_calldata_bytes
    - *sum_to_tx_calldata_gas
 